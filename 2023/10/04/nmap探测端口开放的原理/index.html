<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>nmap探测端口开放的原理 | M4c0ndo's Blog</title><meta name="author" content="M4c0ndo"><meta name="copyright" content="M4c0ndo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="nmapNmap（ Network Mapper）是一个用于网络探索和安全审计的开源工具，可用于快速扫描大型网络，使用原始 IP 数据包来确定网络上可用的主机、这些主机提供的服务（应用程序名称和版本）、它们运行的操作系统（和操作系统版本）、正在使用的数据包过滤器&#x2F;防火墙的类型等。 nmap官方文档：https:&#x2F;&#x2F;nmap.org&#x2F;book&#x2F; nmap的选项摘要nmap的选项摘要： Nm">
<meta property="og:type" content="article">
<meta property="og:title" content="nmap探测端口开放的原理">
<meta property="og:url" content="https://m4c0ndo.github.io/2023/10/04/nmap%E6%8E%A2%E6%B5%8B%E7%AB%AF%E5%8F%A3%E5%BC%80%E6%94%BE%E7%9A%84%E5%8E%9F%E7%90%86/index.html">
<meta property="og:site_name" content="M4c0ndo&#39;s Blog">
<meta property="og:description" content="nmapNmap（ Network Mapper）是一个用于网络探索和安全审计的开源工具，可用于快速扫描大型网络，使用原始 IP 数据包来确定网络上可用的主机、这些主机提供的服务（应用程序名称和版本）、它们运行的操作系统（和操作系统版本）、正在使用的数据包过滤器&#x2F;防火墙的类型等。 nmap官方文档：https:&#x2F;&#x2F;nmap.org&#x2F;book&#x2F; nmap的选项摘要nmap的选项摘要： Nm">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://m4c0ndo.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2023-10-04T02:49:28.000Z">
<meta property="article:modified_time" content="2023-10-04T13:45:38.622Z">
<meta property="article:author" content="M4c0ndo">
<meta property="article:tag" content="nmap">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://m4c0ndo.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://m4c0ndo.github.io/2023/10/04/nmap%E6%8E%A2%E6%B5%8B%E7%AB%AF%E5%8F%A3%E5%BC%80%E6%94%BE%E7%9A%84%E5%8E%9F%E7%90%86/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'nmap探测端口开放的原理',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-04 21:45:38'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-diamond"></i><span> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于本人</span></a></li><li><a class="site-page child" href="/nav/web.html"><i class="fa-fw fa-fw fas fa-infinity"></i><span> 网址导航</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/default_top_img.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="M4c0ndo's Blog"><span class="site-name">M4c0ndo's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-diamond"></i><span> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于本人</span></a></li><li><a class="site-page child" href="/nav/web.html"><i class="fa-fw fa-fw fas fa-infinity"></i><span> 网址导航</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">nmap探测端口开放的原理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-04T02:49:28.000Z" title="发表于 2023-10-04 10:49:28">2023-10-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-04T13:45:38.622Z" title="更新于 2023-10-04 21:45:38">2023-10-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%8E%9F%E7%90%86/">原理</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">16.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>54分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="nmap探测端口开放的原理"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><p>Nmap（ Network Mapper）是一个用于网络探索和安全审计的开源工具，可用于快速扫描大型网络，使用原始 IP 数据包来确定网络上可用的主机、这些主机提供的服务（应用程序名称和版本）、它们运行的操作系统（和操作系统版本）、正在使用的数据包过滤器&#x2F;防火墙的类型等。</p>
<p>nmap官方文档：<a target="_blank" rel="noopener" href="https://nmap.org/book/">https://nmap.org/book/</a></p>
<h2 id="nmap的选项摘要"><a href="#nmap的选项摘要" class="headerlink" title="nmap的选项摘要"></a>nmap的选项摘要</h2><p>nmap的选项摘要：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Nmap 7.93SVN ( https://nmap.org )</span><br><span class="line">用法：nmap [扫描类型] [选项] &#123;目标规范&#125;</span><br><span class="line">目标规格：</span><br><span class="line">  可以传递主机名、IP 地址、网络等。</span><br><span class="line">  例如：scanme.nmap.org、microsoft.com/24、192.168.0.1；10.0.0-255.1-254</span><br><span class="line">  -iL &lt;输入文件名&gt;：来自主机/网络列表的输入</span><br><span class="line">  -iR &lt;num Hosts&gt;：选择随机目标</span><br><span class="line">  --exclude &lt;host1[,host2][,host3],...&gt;: 排除主机/网络</span><br><span class="line">  --excludefile &lt;exclude_file&gt;：从文件中排除列表</span><br><span class="line">主机发现：</span><br><span class="line">  -sL：列表扫描 - 只需列出要扫描的目标</span><br><span class="line">  -sn：Ping 扫描 - 禁用端口扫描</span><br><span class="line">  -Pn：将所有主机视为在线--跳过主机发现</span><br><span class="line">  -PS/PA/PU/PY[端口列表]：给定端口的 TCP SYN/ACK、UDP 或 SCTP 发现</span><br><span class="line">  -PE/PP/PM：ICMP 回显、时间戳和网络掩码请求发现探测</span><br><span class="line">  -PO[协议列表]：IP协议Ping</span><br><span class="line">  -n/-R：从不进行 DNS 解析/始终解析 [默认值：有时]</span><br><span class="line">  --dns-servers &lt;serv1[,serv2],...&gt;: 指定自定义 DNS 服务器</span><br><span class="line">  --system-dns：使用操作系统的 DNS 解析器</span><br><span class="line">  --traceroute：跟踪每个主机的跃点路径</span><br><span class="line">扫描技术：</span><br><span class="line">  -sS/sT/sA/sW/sM：TCP SYN/Connect()/ACK/Window/Maimon 扫描</span><br><span class="line">  -sU：UDP扫描</span><br><span class="line">  -sN/sF/sX：TCP Null、FIN 和 Xmas 扫描</span><br><span class="line">  --scanflags &lt;flags&gt;: 自定义 TCP 扫描标志</span><br><span class="line">  -sI &lt;僵尸主机[:probeport]&gt;：空闲扫描</span><br><span class="line">  -sY/sZ：SCTP INIT/COOKIE-ECHO 扫描</span><br><span class="line">  -sO：IP协议扫描</span><br><span class="line">  -b &lt;FTP中继主机&gt;：FTP反弹扫描</span><br><span class="line">端口规格和扫描顺序：</span><br><span class="line">  -p &lt;端口范围&gt;：仅扫描指定端口</span><br><span class="line">    例如：-p22；-p1-65535；-p U:53,111,137,T:21-25,80,139,8080,S:9</span><br><span class="line">  --exclude-ports &lt;端口范围&gt;：从扫描中排除指定端口</span><br><span class="line">  -F：快速模式 - 扫描比默认扫描更少的端口</span><br><span class="line">  -r：按顺序扫描端口 - 不要随机化</span><br><span class="line">  --top-ports &lt;number&gt;: 扫描 &lt;number&gt; 个最常见端口</span><br><span class="line">  --port-ratio &lt;ratio&gt;：扫描比&lt;ratio&gt;更常见的端口</span><br><span class="line">服务/版本检测：</span><br><span class="line">  -sV：探测开放端口以确定服务/版本信息</span><br><span class="line">  --version-intensity &lt;level&gt;: 设置从 0 (light) 到 9 (尝试所有探针)</span><br><span class="line">  --version-light：限制最有可能的探测（强度 2）</span><br><span class="line">  --version-all：尝试每个探针（强度 9）</span><br><span class="line">  --version-trace：显示详细的版本扫描活动（用于调试）</span><br><span class="line">脚本扫描：</span><br><span class="line">  -sC：相当于--script=default</span><br><span class="line">  --script=&lt;Lua 脚本&gt;: &lt;Lua 脚本&gt; 是逗号分隔的列表</span><br><span class="line">           目录、脚本文件或脚本类别</span><br><span class="line">  --script-args=&lt;n1=v1,[n2=v2,...]&gt;: 为脚本提供参数</span><br><span class="line">  --script-args-file=文件名：在文件中提供 NSE 脚本参数</span><br><span class="line">  --script-trace：显示发送和接收的所有数据</span><br><span class="line">  --script-updatedb：更新脚本数据库。</span><br><span class="line">  --script-help=&lt;Lua 脚本&gt;：显示有关脚本的帮助。</span><br><span class="line">           &lt;Lua scripts&gt; 是一个以逗号分隔的脚本文件列表或</span><br><span class="line">           脚本类别。</span><br><span class="line">操作系统检测：</span><br><span class="line">  -O：启用操作系统检测</span><br><span class="line">  --osscan-limit：将操作系统检测限制为有希望的目标</span><br><span class="line">  --osscan-guess：更积极地猜测操作系统</span><br><span class="line">时间安排和表演：</span><br><span class="line">  需要&lt;time&gt;的选项以秒为单位，或附加“ms”（毫秒），</span><br><span class="line">  将“s”（秒）、“m”（分钟）或“h”（小时）转换为值（例如 30m）。</span><br><span class="line">  -T&lt;0-5&gt;：设置计时模板（越高越快）</span><br><span class="line">  --min-hostgroup/max-hostgroup &lt;size&gt;：并行主机扫描组大小</span><br><span class="line">  --min-parallelism/max-parallelism &lt;numprobes&gt;：探测并行化</span><br><span class="line">  --min-rtt-timeout/max-rtt-timeout/initial-rtt-timeout &lt;时间&gt;：指定</span><br><span class="line">      探头往返时间。</span><br><span class="line">  --max-retries &lt;tries&gt;：端口扫描探测重传次数的上限。</span><br><span class="line">  --host-timeout &lt;时间&gt;：经过这么长时间后放弃目标</span><br><span class="line">  --scan-delay/--max-scan-delay &lt;时间&gt;：调整探头之间的延迟</span><br><span class="line">  --min-rate &lt;number&gt;: 每秒发送数据包的速度不低于&lt;number&gt;</span><br><span class="line">  --max-rate &lt;number&gt;: 每秒发送数据包的速度不超过 &lt;number&gt;</span><br><span class="line">防火墙/IDS 规避和欺骗：</span><br><span class="line">  -F; --mtu &lt;val&gt;：片段数据包（可选地带有给定的 MTU）</span><br><span class="line">  -D &lt;decoy1,decoy2[,ME],...&gt;：用诱饵隐藏扫描</span><br><span class="line">  -S &lt;IP_Address&gt;：欺骗源地址</span><br><span class="line">  -e &lt;iface&gt;：使用指定的接口</span><br><span class="line">  -g/--source-port &lt;portnum&gt;：使用给定的端口号</span><br><span class="line">  --proxies &lt;url1,[url2],...&gt;: 通过 HTTP/SOCKS4 代理中继连接</span><br><span class="line">  --data &lt;十六进制字符串&gt;：将自定义负载附加到发送的数据包中</span><br><span class="line">  --data-string &lt;string&gt;：将自定义 ASCII 字符串附加到发送的数据包中</span><br><span class="line">  --data-length &lt;num&gt;：将随机数据附加到发送的数据包中</span><br><span class="line">  --ip-options &lt;options&gt;: 发送带有指定ip选项的数据包</span><br><span class="line">  --ttl &lt;val&gt;: 设置IP生存时间字段</span><br><span class="line">  --spoof-mac &lt;mac 地址/前缀/供应商名称&gt;: 欺骗您的 MAC 地址</span><br><span class="line">  --badsum：发送带有伪造 TCP/UDP/SCTP 校验和的数据包</span><br><span class="line">输出：</span><br><span class="line">  -oN/-oX/-oS/-oG &lt;文件&gt;：以正常、XML、s|&lt;rIpt kIddi3 输出扫描，</span><br><span class="line">     和 Grepable 格式分别为给定的文件名。</span><br><span class="line">  -oA &lt;basename&gt;：同时以三种主要格式输出</span><br><span class="line">  -v：增加详细级别（使用-vv或更多以获得更好的效果）</span><br><span class="line">  -d：提高调试级别（使用-dd或更多以获得更好的效果）</span><br><span class="line">  --reason：显示端口处于特定状态的原因</span><br><span class="line">  --open：仅显示开放（或可能开放）的端口</span><br><span class="line">  --packet-trace：显示发送和接收的所有数据包</span><br><span class="line">  --iflist：打印主机接口和路由（用于调试）</span><br><span class="line">  --append-output：附加到而不是破坏指定的输出文件</span><br><span class="line">  --resume &lt;文件名&gt;：恢复中止的扫描</span><br><span class="line">  --noninteractive：通过键盘禁用运行时交互</span><br><span class="line">  --stylesheet &lt;path/URL&gt;：用于将 XML 输出转换为 HTML 的 XSL 样式表</span><br><span class="line">  --webxml：来自 Nmap.Org 的参考样式表，以获得更可移植的 XML</span><br><span class="line">  --no-stylesheet：防止 XSL 样式表与 XML 输出关联</span><br><span class="line">其他：</span><br><span class="line">  -6：启用 IPv6 扫描</span><br><span class="line">  -A：启用操作系统检测、版本检测、脚本扫描和traceroute</span><br><span class="line">  --datadir &lt;dirname&gt;: 指定自定义 Nmap 数据文件位置</span><br><span class="line">  --send-eth/--send-ip：使用原始以太网帧或 IP 数据包发送</span><br><span class="line">  --privileged：假设用户具有完全特权</span><br><span class="line">  --unprivileged：假设用户缺乏原始套接字权限</span><br><span class="line">  -V：打印版本号</span><br><span class="line">  -h：打印此帮助摘要页。</span><br></pre></td></tr></table></figure>

<h3 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h3><p>主机发现可以将一组（有时是巨大的）IP 范围缩减为活动或感兴趣的主机列表。不同使用者会根据不同目的进行主机扫描，比如管理员可能仅使用 ICMP ping 来定位其内部网络上的主机，而外部渗透测试人员可能会使用数十个不同的探测器来尝试绕过防火墙的探测。</p>
<p>主机发现有时称为 ping 扫描，但它远远超出了与无处不在的ping工具相关的简单 ICMP 回显请求数据包。</p>
<p>用户可以通过列表扫描 ( <code>-sL</code>) 或禁用主机发现 (<code>-Pn</code> )来完全跳过发现步骤，或者使用多端口 TCP SYN&#x2F;ACK、UDP、SCTP INIT 和 ICMP 探测的任意组合来连接网络。这些探测的目标是请求响应，以证明 IP 地址实际上是活动的（正在被主机或网络设备使用）。</p>
<p>如果没有给出主机发现选项，Nmap 将发送 ICMP 回显请求、TCP SYN 数据包到端口 443、TCP ACK 数据包到端口 80 以及 ICMP 时间戳请求。</p>
<p>默认情况下，Nmap 进行主机发现，然后对其确定在线的每个主机执行端口扫描。如<code>-sn</code>仅执行主机发现，或用<code>-Pn</code>跳过主机发现并对所有目标地址进行端口扫描。</p>
<p><strong>以下选项控制主机发现：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sL（列表扫描）</span><br></pre></td></tr></table></figure>

<p>列表扫描是主机发现的一种简并形式，它仅列出指定网络的每个主机，而不向目标主机发送任何数据包。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sn（无端口扫描）</span><br></pre></td></tr></table></figure>

<p>该选项告诉 Nmap 在主机发现后不要进行端口扫描，而只打印出响应主机发现探测的可用主机。这通常称为ping 扫描，并且比 ping 广播地址更可靠，因为许多主机不会回复广播查询。默认情况下，这比列表扫描更具侵入性，并且通常可用于相同目的。对于攻击者来说，了解有多少主机处于运行状态比通过对每个 IP 和主机名进行列表扫描所提供的列表更有价值。</p>
<p>默认情况下，完成的默认主机发现<code>-sn</code>由 ICMP 回显请求、端口 443 的 TCP SYN、端口 80 的 TCP ACK 以及 ICMP 时间戳请求组成。当由非特权用户执行时，默认探测是使用<code>connect</code>系统调用发送到端口 80 和 443 的 SYN 数据包。当特权用户尝试扫描本地以太网上的目标时，除非 <code>--send-ip</code>指定，否则将使用 ARP 请求。该<code>-sn</code>选项可以与任何发现探测类型（<code>-P*</code>选项）组合以获得更大的灵活性。如果使用任何这些探测类型和端口号选项，则默认探测将被覆盖。</p>
<p>在 Nmap 的早期版本中，<code>-sn</code>被称为 <code>-sP</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-Pn（无 ping）</span><br></pre></td></tr></table></figure>

<p>此选项完全跳过主机发现阶段。通常，Nmap 使用此阶段来确定活动机器以进行较重的扫描并测量网络速度。默认情况下，Nmap 仅对发现已启动的主机执行大量探测，例如端口扫描、版本检测或操作系统检测。禁用主机发现会导致 Nmap 对每个主机尝试请求扫描功能。与列表扫描一样，会跳过正确的主机发现，但 Nmap 不会停止并打印目标列表，而是继续执行请求的功能，就好像每个目标 IP 都处于活动状态一样。</p>
<p>对于本地以太网上的机器，仍然会执行 ARP 扫描（除非指定<code>--disable-arp-ping</code>或<code>--send-ip</code>），因为 Nmap 需要 MAC 地址来进一步扫描目标主机。在 Nmap 的早期版本中，<code>-Pn</code>是 <code>-P0</code> 和 <code>-PN</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-PS *&lt;port list&gt;*（TCP SYN Ping）</span><br></pre></td></tr></table></figure>

<p>此选项发送一个设置了 SYN 标志的空 TCP 数据包。默认目标端口为 80（可在编译时通过更改进行<code>DEFAULT_TCP_PROBE_PORT_SPEC</code> 配置<code>nmap.h</code>）。 可以将备用端口指定为参数。</p>
<p>SYN 标志向远程系统表明您正在尝试建立连接。通常目的端口将被关闭，并发回一个RST（重置）数据包。 如果端口恰好打开，目标将通过响应 SYN&#x2F;ACK TCP 数据包来执行 TCP 三向握手的第二步。然后，运行 Nmap 的机器通过 RST 响应来断开新生连接，而不是发送 ACK 数据包，后者将完成三次握手并建立完整连接。RST 数据包是由运行 Nmap 的机器的内核发送的，以响应意外的 SYN&#x2F;ACK，而不是由 Nmap 本身发送。</p>
<p>在 Unix 机器上，通常只有特权用户 <code>root</code> 才能发送和接收原始 TCP 数据包。 对于非特权用户，系统会自动采用一种解决方法 ，<code>connect</code>针对每个目标端口启动系统调用。这会向目标主机发送 SYN 数据包，以尝试建立连接。如果<code>connect</code>快速成功返回或 ECONNREFUSED 失败，则底层 TCP 堆栈必须已收到 SYN&#x2F;ACK 或 RST，并且主机被标记为可用。如果连接尝试一直挂起直到达到超时，则主机将被标记为关闭。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-PA *&lt;port list&gt;*（TCP ACK Ping）</span><br></pre></td></tr></table></figure>

<p>TCP ACK ping 与刚才讨论的 SYN ping 非常相似。正如您可能猜到的那样，区别在于设置了 TCP ACK 标志而不是 SYN 标志。此类 ACK 数据包声称通过已建立的 TCP 连接确认数据，但此类连接并不存在。因此，远程主机应始终使用 RST 数据包进行响应，以公开其进程中的存在。</p>
<p>该<code>-PA</code>选项使用与 SYN 探测 (80) 相同的默认端口，并且还可以采用相同格式的目标端口列表。如果非特权用户尝试执行此操作， <code>connect</code>则会使用前面讨论的解决方法。此解决方法并不完美，因为<code>connect</code>实际上发送的是 SYN 数据包而不是 ACK。</p>
<p>同时提供 SYN 和 ACK ping 探测的原因是为了最大限度地提高绕过防火墙的机会。许多管理员配置路由器和其他简单的防火墙来阻止传入的 SYN 数据包，但那些发往公共服务（例如公司网站或邮件服务器）的数据包除外。这可以防止与组织的其他传入连接，同时允许用户与 Internet 建立畅通无阻的传出连接。这种无状态方法占用防火墙&#x2F;路由器上的资源很少，并且受到硬件和软件过滤器的广泛支持。Linux Netfilter&#x2F;iptables 防火墙软件提供了 <code>--syn</code>实现这种无状态方法的便捷选项。当诸如此类的无状态防火墙规则就位时，SYN ping 探测 ( <code>-PS</code>) 在发送到关闭的目标端口时可能会被阻止。<strong>在这种情况下，ACK 探测会大放异彩，因为它直接突破了这些规则。</strong></p>
<p>另一种常见类型的防火墙使用状态规则来丢弃意外的数据包。Linux Netfilter&#x2F;iptables 系统通过 <code>--state</code>选项支持这一点，该选项根据连接状态对数据包进行分类。SYN 探测更有可能对此类系统起作用，因为意外的 ACK 数据包通常会被识别为伪造的数据包并被丢弃。解决这个困境的一个解决方案是通过指定 <code>-PS</code>和来发送 SYN 和 ACK 探测<code>-PA</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-PU *&lt;port list&gt;*（UDP 平）</span><br></pre></td></tr></table></figure>

<p>另一个主机发现选项是 UDP ping，它将 UDP 数据包发送到给定端口。对于大多数端口，数据包将为空，但有些端口使用更可能引发响应的特定于协议的有效负载。 有效负载与服务和版本检测中使用的探针相同，并在 <code>nmap-service-probes</code> 文件中定义。数据包内容也可能受到 <code>--data</code>、<code>--data-string</code>、 和 <code>--data-length</code>选项的影响。</p>
<p>端口列表采用与前面讨论的选项相同的 <code>-PS</code>格式<code>-PA</code>。如果未指定端口，则默认值为 40125。 </p>
<p>在到达目标计算机上的关闭端口后，UDP 探测应引出 ICMP 端口不可达数据包作为返回。这向 Nmap 表明该机器已启动且可用。许多其他类型的 ICMP 错误（例如主机&#x2F;网络无法访问或超出 TTL）都表明主机已关闭或无法访问。缺乏回应也可以这样解释。如果到达开放端口，大多数服务只会忽略空数据包并且无法返回任何响应。这就是为什么默认探测端口是 40125，该端口极不可能被使用。一些服务，例如字符生成器 (chargen) 协议，将响应空的 UDP 数据包，从而向 Nmap 透露该机器可用。</p>
<p>这种扫描类型的主要优点是它绕过仅屏蔽 TCP 的防火墙和过滤器。例如，我曾经拥有一台Linksys BEFW11S4无线宽带路由器。该设备的外部接口默认过滤所有 TCP 端口，<strong>但 UDP 探测仍然会引发端口不可达消息，从而泄露该设备。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-PY *&lt;port list&gt;*（SCTP 初始化 Ping）</span><br></pre></td></tr></table></figure>

<p>此选项发送包含最小 INIT 块的 SCTP 数据包。默认目标端口为 80。可以将备用端口指定为参数。</p>
<p>例子： <code>-PY22</code>和 <code>-PY22,80,179,5060</code>。</p>
<p>在 Unix 机器上，通常只有特权用户 <code>root</code> 才能发送和接收原始 SCTP 数据包。 目前，非特权用户无法使用 SCTP INIT Ping。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-PE; -PP; -PM（ICMP Ping 类型）</span><br></pre></td></tr></table></figure>

<p>除了前面讨论的不常见的 TCP、UDP 和 SCTP 主机发现类型之外，Nmap 还可以发送由无处不在的 ping程序发送的标准数据包。Nmap 向目标 IP 地址发送 ICMP 类型 8（回显请求）数据包，期望从可用主机返回类型 0（回显应答）。 不幸的是，对于网络浏览器来说，许多主机和防火墙现在会阻止这些数据包，而不是按照期望进行响应。 因此，针对 Internet 上的未知目标，仅 ICMP 扫描很少足够可靠。但对于监控内部网络的系统管理员来说，它们可能是一种实用且有效的方法。使用该<code>-PE</code>选项启用此回显请求行为。</p>
<p>虽然 echo 请求是标准的 ICMP ping 查询，但 Nmap 并不止于此。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-PO *&lt;protocol list&gt;*（IP 协议 Ping）</span><br></pre></td></tr></table></figure>

<p>较新的主机发现选项之一是 IP 协议 ping，它发送 IP 数据包，并在其 IP 标头中设置指定的协议号。协议列表采用与前面讨论的 TCP、UDP 和 SCTP 主机发现选项中的端口列表相同的格式。</p>
<p>此主机发现方法查找使用与探测相同的协议的响应，或者查找表示目标主机不支持给定协议的 ICMP 协议不可达消息。无论哪种类型的响应都表明目标主机还活着。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--disable-arp-ping（无 ARP 或 ND Ping）</span><br></pre></td></tr></table></figure>

<p>Nmap 通常对本地连接的以太网主机进行 ARP 或 IPv6 邻居发现 (ND) 发现，即使使用其他主机发现选项（例如<code>-Pn</code>或 ） 。<code>-PE</code>要禁用此隐式行为，请使用该<code>--disable-arp-ping</code> 选项。</p>
<p>默认行为通常更快，但此选项在使用代理 ARP 的网络上很有用，在这种网络中，路由器会推测性地回复所有 ARP 请求，使每个目标根据 ARP 扫描看起来都已启动。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--discovery-ignore-rst</span><br></pre></td></tr></table></figure>

<p>在某些情况下，防火墙可能会欺骗 TCP 重置 (RST) 回复，以响应对未占用或不允许的地址的探测。由于 Nmap 通常认为 RST 回复是目标已启动的证据，这可能会导致浪费时间扫描不存在的目标。使用<code>--discovery-ignore-rst</code>将阻止 Nmap 在主机发现期间考虑这些回复。在这种情况下，您可能需要选择额外的主机发现选项以确保不会错过目标。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--traceroute（跟踪主机路径）</span><br></pre></td></tr></table></figure>

<p>扫描后使用扫描结果中的信息执行跟踪路由，以确定最有可能到达目标的端口和协议。它适用于除连接扫描 ( <code>-sT</code>) 和空闲扫描 ( <code>-sI</code>) 之外的所有扫描类型。所有跟踪均使用 Nmap 的动态时序模型并并行执行。</p>
<p>Traceroute 的工作原理是发送低 TTL（生存时间）数据包，尝试从扫描器和目标主机之间的中间跃点获取 ICMP 超时消息。标准跟踪路由实现从 TTL 1 开始，并递增 TTL，直到到达目标主机。Nmap 的跟踪路由以高 TTL 开始，然后递减 TTL 直到达到零。向后执行可以让 Nmap 采用巧妙的缓存算法来加速多个主机上的跟踪。根据网络状况，Nmap 平均每台主机发送的数据包数量减少 5-10 个。如果正在扫描单个子网（即 192.168.0.0&#x2F;24），Nmap 可能只需向大多数主机发送两个数据包。</p>
<h3 id="端口扫描基础知识"><a href="#端口扫描基础知识" class="headerlink" title="端口扫描基础知识"></a>端口扫描基础知识</h3><p>虽然 Nmap 的功能多年来不断发展，但它最初是一个高效的端口扫描器，并且这仍然是其核心功能。虽然许多端口扫描器传统上将所有端口集中到打开或关闭状态，但 Nmap 的粒度更加细化。它将端口分为六种状态：<code>open</code>、 <code>closed</code>、<code>filtered</code>、 <code>unfiltered</code>、 <code>open|filtered</code>、 或 <code>closed|filtered</code>。</p>
<p>这些状态不是端口本身的固有属性，而是描述 Nmap 如何看待它们。例如，来自与目标相同网络的 Nmap 扫描可能会显示端口<code>135/tcp</code>为开放状态，而同时使用相同选项来自 Internet 的扫描可能会将该端口显示为<code>filtered</code>。</p>
<p><strong>Nmap认可的六个端口状态：</strong></p>
<ul>
<li><p><code>open</code>打开</p>
<p><code>Open</code> 意味着目标计算机上的应用程序正在侦听该端口上的连接&#x2F;数据包。 </p>
<p>应用程序正在此端口上主动接受 TCP 连接、UDP 数据报或 SCTP 关联。找到这些通常是端口扫描的主要目标。开放端口对于非安全扫描也很有趣，因为它们显示可在网络上使用的服务。</p>
</li>
<li><p><code>filtered</code>关闭</p>
<p><code>Filtered</code> 表示防火墙、过滤器或其他网络障碍物阻塞了该端口，因此 Nmap 无法判断它是 <code>open</code>还是<code>closed</code>。</p>
<p>关闭的端口可以访问（它接收并响应 Nmap 探测数据包），但没有应用程序侦听该端口。它们有助于显示主机在 IP 地址上启动（主机发现或 ping 扫描），并作为操作系统检测的一部分。由于关闭的端口是可以访问的，因此可能值得稍后扫描，以防某些端口打开。</p>
</li>
<li><p><code>closed</code>过滤的</p>
<p>Nmap 无法确定端口是否打开，因为数据包过滤阻止其探测到达该端口。过滤可以来自专用防火墙设备、路由器规则或基于主机的防火墙软件。这些端口让攻击者感到沮丧，因为它们提供的信息很少。有时，它们会使用 ICMP 错误消息进行响应，例如类型 3 代码 13（目标无法到达：管理上禁止通信），但简单地丢弃探测而不响应的过滤器更为常见。这迫使 Nmap 重试几次，以防探测由于网络拥塞而不是过滤而被丢弃。这会大大减慢扫描速度。</p>
</li>
<li><p><code>unfiltered</code>未过滤的</p>
<p>未过滤状态意味着端口可以访问，但 Nmap 无法确定该端口是打开还是关闭。只有用于映射防火墙规则集的 ACK 扫描才会将端口分类为此状态。使用其他扫描类型（例如窗口扫描、SYN 扫描或 FIN 扫描）扫描未过滤的端口可能有助于确定端口是否打开。</p>
</li>
<li><p><code>open|filtered</code>打开|过滤</p>
<p>当 Nmap 无法确定端口是开放还是已过滤时，会将端口置于此状态。对于开放端口没有响应的扫描类型，会发生这种情况。缺乏响应还可能意味着数据包过滤器丢弃了探测或其引起的任何响应。所以Nmap不能确定端口是开放的还是被过滤的。UDP、IP 协议、FIN、NULL 和 Xmas 扫描以这种方式对端口进行分类。</p>
</li>
<li><p><code>closed|filtered</code>封闭|过滤</p>
<p>当 Nmap 无法确定端口是关闭还是被过滤时，使用此状态。它仅用于 IP ID 空闲扫描。</p>
</li>
</ul>
<h3 id="端口扫描技术"><a href="#端口扫描技术" class="headerlink" title="端口扫描技术"></a>端口扫描技术</h3><p>Nmap 的所有扫描结果都是基于目标计算机（或它们前面的防火墙）返回的数据包，这些数据包可能会误导 Nmap 的响应。</p>
<p> Nmap 支持的十几种端口扫描技术，其中UDP 扫描 ( <code>-sU</code>) 和任何一种 SCTP 扫描类型 ( <code>-sY</code>、<code>-sZ</code>) 可以与任何一种 TCP 扫描类型组合。默认情况下，Nmap 执行 SYN 扫描，但如果用户没有发送原始数据包的适当权限（需要 Unix 上的 root 访问权限），它会替代连接扫描。在本节列出的扫描中，非特权用户只能执行连接扫描和 FTP 反弹扫描。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sS（TCP SYN 扫描）</span><br></pre></td></tr></table></figure>

<p>SYN 扫描是默认且最流行的扫描选项，它可以快速执行，在不受限制性防火墙阻碍的快速网络上每秒扫描数千个端口。由于它从不完成 TCP 连接，因此它也相对不引人注目和隐蔽。SYN 扫描适用于任何兼容的 TCP 堆栈，而不是像 Nmap 的 FIN&#x2F;NULL&#x2F;Xmas、Maimon 和空闲扫描那样依赖于特定平台的特性。它还允许在<code>open</code>、 <code>closed</code>和<code>filtered</code> 状态之间进行清晰、可靠的区分。此技术通常称为<strong>半开扫描</strong>，因为您不会建立完整的 TCP 连接。</p>
<p>Nmap发送一个 SYN 数据包，表示想建立一个真正的连接，然后等待响应。SYN&#x2F;ACK 表示端口正在侦听（打开），而 RST（重置）则表示非侦听器。如果多次重传后仍未收到响应，则该端口被标记为已过滤。如果收到 ICMP 不可达错误，该端口也会标记为已过滤。如果收到 SYN 数据包（不带 ACK 标志）作为响应，则该端口也被视为打开。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sT（TCP连接扫描）</span><br></pre></td></tr></table></figure>

<p>当 SYN 扫描不可用时，TCP 连接扫描是默认的 TCP 扫描类型。当用户没有原始数据包权限时就会出现这种情况。Nmap 不像大多数其他扫描类型那样写入原始数据包，而是通过发出系统调用来要求底层操作系统与目标计算机和端口建立连接<code>connect</code>。它是称为 Berkeley Sockets API 的编程接口的一部分。Nmap 使用此 API 来获取每次连接尝试的状态信息，而不是离线读取原始数据包响应。当 SYN 扫描可用时，它通常是更好的选择。Nmap对高层的控制较少<code>connect</code>与原始数据包相比，调用效率较低。</p>
<p><strong>系统调用完成与打开目标端口的连接，而不是执行 SYN 扫描所做的半打开重置。</strong>这不仅需要更长的时间并需要更多的数据包来获取相同的信息，而且目标计算机更有可能记录连接。一个像样的 IDS 可以捕获其中任何一个，但大多数机器没有这样的警报系统。当 Nmap 连接然后关闭连接而不发送数据时，普通 Unix 系统上的许多服务都会在 syslog 中添加一条注释，有时还会添加一条神秘的错误消息。如果管理员在日志中看到来自单个系统的大量连接尝试，则应该知道它已被连接扫描。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sU（UDP 扫描）</span><br></pre></td></tr></table></figure>

<p>虽然 Internet 上大多数流行的服务都运行在 TCP 协议上，但UDP服务也得到了广泛部署。DNS、SNMP 和 DHCP（注册端口 53、161&#x2F;162 和 67&#x2F;68）是最常见的三种。</p>
<p>使用该选项激活 UDP 扫描<code>-sU</code>，Nmap 可以帮助清点 UDP 端口。它可以与 TCP 扫描类型（例如 SYN 扫描 ( <code>-sS</code>)）结合使用，以在同一运行期间检查两种协议。</p>
<p><strong>UDP 扫描的工作原理是向每个目标端口发送 UDP 数据包。</strong><code>--data</code>对于某些常见端口（例如 53 和 161），会发送特定于协议的有效负载以提高响应速度，但对于大多数端口，除非指定 <code>--data-string</code>、 或<code>--data-length</code> 选项，否则数据包为空。如果返回 ICMP 端口不可达错误（类型 3，代码 3），则端口为<code>closed</code>。其他 ICMP 不可达错误将端口标记为<code>filtered</code>。有时，服务会用 UDP 数据包进行响应，证明它是<code>open</code>。如果重传后没有收到响应，则该端口被分类为<code>open|filtered</code>。这意味着端口可能是开放的，或者数据包过滤器可能正在阻止通信。版本检测（<code>-sV</code>）可用于帮助区分真正开放的端口和已过滤的端口。</p>
<p><strong>UDP 扫描的一大挑战是快速完成扫描。</strong>开放和过滤的端口很少发送任何响应，导致 Nmap 超时并重新传输，以防探测或响应丢失。关闭的端口通常是一个更大的问题。它们通常会发回 ICMP 端口不可达错误。但与关闭 TCP 端口发送的 RST 数据包响应 SYN 或连接扫描不同，许多主机 默认对 ICMP 端口不可达消息进行速率限制。Linux 和Solaris 对此特别严格。例如，Linux 2.4.20 内核将目标不可达消息限制为每秒一条（在 中<code>net/ipv4/icmp.c</code>）。Nmap 检测速率限制并相应减慢速度，以避免目标计算机丢弃的无用数据包淹没网络。不幸的是，Linux 风格的每秒一个数据包的限制使得 65,536 个端口扫描需要超过 18 个小时。</p>
<p>加快 UDP 扫描速度的想法包括并行扫描更多主机、首先快速扫描常用端口、从防火墙后面扫描以及用于<code>--host-timeout</code>跳过慢速主机。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sY（SCTP 初始化扫描）</span><br></pre></td></tr></table></figure>

<p>SCTP是 TCP 和 UDP 协议的相对较新的替代协议，结合了 TCP 和 UDP 的大部分特性，还添加了多宿主和多流等新功能。它主要用于 SS7&#x2F;SIGTRAN 相关服务，但也有可能用于其他应用程序。SCTP INIT 扫描相当于 TCP SYN 扫描的 SCTP。它可以快速执行，在不受限制性防火墙阻碍的快速网络上每秒扫描数千个端口。与 SYN 扫描一样，INIT 扫描相对不引人注目且隐蔽，因为它从不完成 SCTP 关联。它还允许在<code>open</code>、 <code>closed</code>和<code>filtered</code> 状态之间进行清晰、可靠的区分。<strong>此技术通常称为半开放扫描，因为您没有打开完整的 SCTP 关联。</strong>Nmap发送一个 INIT 块，就好像要打开一个真正的关联，然后等待响应。INIT-ACK 块指示端口正在侦听（打开），而 ABORT 块指示非侦听器。如果多次重传后仍未收到响应，则该端口被标记为已过滤。如果收到 ICMP 不可达错误，该端口也会标记为已过滤。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sN; -sF; -sX（TCP NULL、FIN 和 Xmas 扫描）</span><br></pre></td></tr></table></figure>

<p><code>--scanflags</code>这三种扫描类型利用TCP REC中的微妙漏洞来区分<code>open</code>和 <code>closed</code>端口。</p>
<p>RFC 793 第 65 页指出“如果 [目标] 端口状态为 CLOSED …. 不包含 RST 的传入数据段会导致发送 RST 作为响应。” 然后下一页讨论发送到未设置 SYN、RST 或 ACK 位的开放端口的数据包，指出：“您不太可能到达这里，但如果到达，则丢弃该段并返回。”<strong>当扫描符合此 RFC 文本的系统时，如果端口关闭，则任何不包含 SYN、RST 或 ACK 位的数据包都将导致返回 RST；如果端口打开，则根本不会响应。</strong>只要不包含这三个位，其他三个位（FIN、PSH 和 URG）的任意组合都可以。</p>
<p>Nmap 通过三种扫描类型利用这一点：空扫描 ( <code>-sN</code>)不设置任何位（TCP 标志标头为 0）FIN 扫描 ( <code>-sF</code>)仅设置 TCP FIN 位。圣诞扫描 ( <code>-sX</code>)设置 FIN、PSH 和 URG 标志，像圣诞树一样点亮数据包。除了探测数据包中设置的 TCP 标志之外，这三种扫描类型的行为完全相同。**如果收到RST包，则认为该端口是<code>closed</code>，没有响应则认为是<code>open|filtered</code>**。<code>filtered</code>如果收到 ICMP 不可达错误，则会标记端口 。</p>
<p><strong>优点：</strong></p>
<ul>
<li><p>可以潜入某些非状态防火墙和数据包过滤路由器。</p>
</li>
<li><p>这些扫描类型比 SYN 扫描更加隐秘</p>
</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>它们无法区分<code>open</code>端口和某些端口<code>filtered</code>，只会留下答复 <code>open|filtered</code>。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sA（TCP ACK 扫描）</span><br></pre></td></tr></table></figure>

<p>此扫描与迄今为止讨论的其他扫描不同，因为它从不确定<code>open</code>（甚至 <code>open|filtered</code>）端口。它用于映射防火墙规则集，确定它们是否有状态以及过滤哪些端口。ACK 扫描探测数据包仅设置了 ACK 标志（除非您使用<code>--scanflags</code>）。当扫描未过滤的系统时， <code>open</code>端口<code>closed</code>都会返回 RST 数据包。然后，Nmap 将它们标记为 <code>unfiltered</code>，这意味着 ACK 数据包可以到达它们，但它们是否是<code>open</code>或 <code>closed</code>尚未确定。不响应或发回某些 ICMP 错误消息的端口标记为<code>filtered</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sW（TCP窗口扫描）</span><br></pre></td></tr></table></figure>

<p>窗口扫描与 ACK 扫描完全相同，只是它利用某些系统的实现细节来区分开放端口和关闭端口，而不是总是 <code>unfiltered</code>在返回 RST 时进行打印。它通过检查返回的 RST 数据包的 TCP 窗口字段来实现此目的。在某些系统上，开放端口使用正窗口大小（即使对于 RST 数据包），而关闭端口则使用零窗口。因此，窗口扫描不是总是<code>unfiltered</code>在收到 RST 返回时列出端口，<code>open</code>而是 <code>closed</code>在重置中的 TCP 窗口值分别为正或零时列出端口。此扫描依赖于互联网上少数系统的实现细节，因此您不能总是信任它。不支持它的系统通常会返回所有端口 <code>closed</code>。当然，也有可能机器确实没有开放端口。如果大多数扫描到的端口 <code>closed</code>只有少数常见端口号（例如 22、25、53）<code>filtered</code>，则系统很可能容易受到影响。有时，系统甚至会表现出完全相反的行为。如果您的扫描显示 1,000 个开放端口和 3 个关闭或过滤的端口，那么这三个端口很可能是真正开放的端口。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sM（TCP迈蒙扫描）</span><br></pre></td></tr></table></figure>

<p>迈蒙扫描以其发现者尤里尔·迈蒙 (Uriel Maimon) 的名字命名。该技术与 NULL、FIN 和 Xmas 扫描完全相同，只不过探测的是 FIN&#x2F;ACK。根据RFC 793 (TCP)，无论端口是打开还是关闭，都应该生成 RST 数据包来响应此类探测。然而，Uriel 注意到，如果端口打开，许多 BSD 派生系统就会简单地丢弃数据包。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--scanflags（自定义 TCP 扫描）</span><br></pre></td></tr></table></figure>

<p>真正高级的 Nmap 用户不需要将自己限制于所提供的预设扫描类型。该<code>--scanflags</code>选项允许您通过指定任意 TCP 标志来设计自己的扫描。 参数<code>--scanflags</code>可以是数字标志值，例如 9（PSH 和 FIN），但使用符号名称更容易。<code>URG</code>只需将、 <code>ACK</code>、<code>PSH</code>、 <code>RST</code>、<code>SYN</code>和 的任意组合混在一起即可 <code>FIN</code>。</p>
<p>例如，<code>--scanflags URGACKPSHRSTSYNFIN</code>设置一切，尽管它对于扫描不是很有用。</p>
<p>除了指定所需的标志之外，您还可以指定 TCP 扫描类型（例如<code>-sA</code>或<code>-sF</code>）。该基本类型告诉 Nmap 如何解释响应。例如，SYN 扫描认为无响应来指示端口 <code>filtered</code>，而 FIN 扫描则将其视为相同 <code>open|filtered</code>。Nmap 的行为方式与基本扫描类型相同，只是它将使用您指定的 TCP 标志。如果不指定基本类型，则使用 SYN 扫描。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sZ（SCTP COOKIE ECHO 扫描）</span><br></pre></td></tr></table></figure>

<p>SCTP COOKIE ECHO 扫描是更高级的 SCTP 扫描。它利用了这样一个事实：SCTP 实现应该在开放端口上静默丢弃包含 COOKIE ECHO 块的数据包，但如果端口关闭则发送 ABORT。这种扫描类型的优点是端口扫描不像 INIT 扫描那么明显。此外，可能存在阻止 INIT 块的非状态防火墙规则集，但不阻止 COOKIE ECHO 块。不要误以为这会使端口扫描不可见；好的 IDS 也能够检测 SCTP COOKIE ECHO 扫描。缺点是 SCTP COOKIE ECHO 扫描无法区分<code>open</code>和端口，因此您只能了解 两种情况下的<code>filtered</code> 状态。<code>open|filtered</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sI *&lt;zombie host&gt;*[:*&lt;probeport&gt;*]（空闲扫描）</span><br></pre></td></tr></table></figure>

<p>这种先进的扫描方法允许对目标进行真正的盲 TCP 端口扫描（<strong>意味着不会从您的真实 IP 地址向目标发送任何数据包</strong>）。相反，独特的旁路攻击利用僵尸主机上可预测的 IP 碎片 ID 序列生成来收集有关目标上开放端口的信息。IDS 系统会将扫描显示为来自您指定的僵尸计算机（该计算机必须启动并满足特定条件）。</p>
<p>除了非常隐蔽（由于其盲目性）之外，这种扫描类型还允许映射机器之间基于 IP 的信任关系。端口列表 从僵尸主机的角度显示开放端口。因此，您可以尝试使用您认为可能可信的各种僵尸来扫描目标 （通过路由器&#x2F;数据包过滤规则）。如果您希望探测僵尸主机上的特定端口以获取 IP ID 更改，则可以向僵尸主机添加一个冒号，后跟端口号。否则，Nmap 将使用默认情况下用于 TCP ping 的端口 (80)。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sO（IP协议扫描）</span><br></pre></td></tr></table></figure>

<p>IP 协议扫描允许您确定目标计算机支持哪些 IP 协议（TCP、ICMP、IGMP 等）。从技术上讲，这不是端口扫描，因为它循环遍历 IP 协议号而不是 TCP 或 UDP 端口号。然而，它仍然使用该 <code>-p</code>选项来选择扫描的协议号，以正常的端口表格式报告其结果，甚至使用与真正的端口扫描方法相同的底层扫描引擎。因此它与端口扫描足够接近，因此属于此处。</p>
<p>除了本身有用之外，协议扫描还展示了开源软件的强大功能。协议扫描的工作方式与 UDP 扫描类似。它不是遍历 UDP 数据包的端口号字段，而是发送 IP 数据包标头并遍历 8 位 IP 协议字段。标头通常是空的，不包含任何数据，甚至不包含所声明协议的正确标头。TCP、UDP、ICMP、SCTP 和 IGMP 除外。包含了这些协议的正确协议头，因为某些系统不会以其他方式发送它们，而且 Nmap 已经具有创建它们的函数。协议扫描不是监视 ICMP 端口不可达消息，而是查找 ICMP 协议不可达消息。如果 Nmap 从目标主机接收到任何协议的任何响应，Nmap 将该协议标记为<code>open</code>。ICMP 协议不可达错误导致协议被标记为<code>closed</code>，而端口不可达则将该协议标记为<code>open</code>。其他 ICMP 不可达错误会导致协议被标记为<code>open</code>，如果重传后没有收到响应，则协议被标记 <code>open|filtered</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-b *&lt;FTP relay host&gt;*（FTP 反弹扫描）</span><br></pre></td></tr></table></figure>

<p>FTP 协议的一个有趣功能是支持所谓的代理 FTP 连接。这允许用户连接到一台 FTP 服务器，然后要求将文件发送到第三方服务器。这样的功能在很多层面上都容易被滥用，因此大多数服务器已经停止支持它。此功能允许的滥用行为之一是导致 FTP 服务器对其他主机进行端口扫描。只需要求 FTP 服务器依次将文件发送到目标主机的每个感兴趣的端口即可。错误消息将描述端口是否打开。这是绕过防火墙的好方法，因为组织 FTP 服务器通常放置在比任何旧 Internet 主机更能访问其他内部主机的位置。</p>
<p>Nmap 通过选项支持 FTP 反弹扫描<code>-b</code>。它需要以下形式的参数 <em><code>&lt;username&gt;</code><em>：</em><code>&lt;password&gt;</code></em>@ <em><code>&lt;server&gt;</code><em>：。</em><code>&lt;port&gt;</code></em>_ *<code>&lt;Server&gt;</code>*是易受攻击的 FTP 服务器的名称或 IP 地址。与普通 URL 一样，您可以省略 <em><code>&lt;username&gt;</code></em>: *<code>&lt;password&gt;</code>*，在这种情况下 将使用匿名登录凭据（用户：<code>anonymous</code>密码：） 。<code>-wwwuser@</code>端口号（以及前面的冒号）也可以省略，在这种情况下， *<code>&lt;server&gt;</code>*将使用默认的 FTP 端口 (21)。</p>
<h3 id="端口规格和扫描顺序"><a href="#端口规格和扫描顺序" class="headerlink" title="端口规格和扫描顺序"></a>端口规格和扫描顺序</h3><p>Nmap 提供用于指定扫描哪些端口以及扫描顺序是随机还是顺序的选项。默认情况下，Nmap 扫描每个协议最常见的 1,000 个端口。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-p *&lt;port ranges&gt;*（只扫描指定端口）</span><br></pre></td></tr></table></figure>

<p>此选项指定您要扫描的端口并覆盖默认值。</p>
<p>例如，该参数<code>-p U:53,111,137,T:21-25,80,139,8080</code>将扫描 UDP 端口 53、111 和 137，以及列出的 TCP 端口。</p>
<p>请注意，要扫描 UDP 和 TCP，您必须指定 <code>-sU</code>至少一种 TCP 扫描类型（例如 <code>-sS</code>、<code>-sF</code>或 <code>-sT</code>）。如果未给出协议限定符，则端口号将添加到所有协议列表中。</p>
<p>端口也可以根据端口在<code>nmap-services</code>。您甚至可以将通配符<code>*</code>和 <code>?</code>与名称一起使用。例如，要扫描 FTP 以及名称以“ http ”开头的所有端口，请使用<code>-p ftp,http*</code>。端口范围可以用方括号括起来，以指示出现在该范围内的端口<code>nmap-services</code>。例如，以下命令将扫描<code>nmap-services</code> 等于或小于 1024 的所有端口：<code>-p [-1024]</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--exclude-ports *&lt;port ranges&gt;*（从扫描中排除指定端口）</span><br></pre></td></tr></table></figure>

<p>此选项指定您希望 Nmap 从扫描中排除哪些端口。它们*<code>&lt;port ranges&gt;</code>* 的指定类似于<code>-p</code>. 对于 IP 协议扫描 ( <code>-sO</code>)，此选项指定您希望排除的协议号 (0–255)。当要求排除端口时，它们将从所有类型的扫描中排除（即在任何情况下都不会被扫描）。这也包括发现阶段。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-F（快速（有限端口）扫描）</span><br></pre></td></tr></table></figure>

<p>指定您希望扫描比默认端口少的端口。通常，Nmap 会为每个扫描协议扫描最常见的 1,000 个端口。使用 时<code>-F</code>，该值减少至 100。Nmap 需要一个<code>nmap-services</code>包含频率信息的文件，以便了解哪些端口最常见。如果端口频率信息不可用，可能是因为使用了自定义<code>nmap-services</code>文件，Nmap 会扫描所有命名端口以及端口 1-1024。在这种情况下， <code>-F</code>意味着仅扫描服务文件中指定的端口。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-r（不要随机化端口）</span><br></pre></td></tr></table></figure>

<p>默认情况下，Nmap 随机化扫描的端口顺序（出于效率原因，某些常用端口被移动到开头附近）。这种随机化通常是可取的，但您可以指定 <code>-r</code>顺序（从最低到最高排序）端口扫描。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--port-ratio *&lt;ratio&gt;*&lt;decimal number between 0 and 1&gt;</span><br></pre></td></tr></table></figure>

<p><code>nmap-services</code>以大于给定的比率扫描文件中的所有端口。*<code>&lt;ratio&gt;</code>*必须介于 0.0 和 1.0 之间。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--top-ports *&lt;n&gt;*</span><br></pre></td></tr></table></figure>

<p>排除 指定的所有端口后，扫描文件*<code>&lt;n&gt;</code><em>中找到的最高比率端口。 必须为 1 或更大。<code>nmap-services``--exclude-ports</code></em><code>&lt;n&gt;</code>*</p>
<h3 id="服务和版本探测"><a href="#服务和版本探测" class="headerlink" title="服务和版本探测"></a>服务和版本探测</h3><p>将 Nmap 指向远程计算机，它可能会告诉您端口<code>25/tcp</code>、<code>80/tcp</code>和<code>53/udp</code>已打开。</p>
<p>使用其他扫描方法之一发现 TCP 和&#x2F;或 UDP 端口后，版本检测会询问这些端口以确定有关实际运行情况的更多信息。这 <code>nmap-service-probes</code> 数据库包含用于查询各种服务的探针和匹配表达式以识别和解析响应。</p>
<p>Nmap 尝试确定<strong>服务协议</strong>（例如 FTP、SSH、Telnet、HTTP）、<strong>应用程序名称</strong>（例如 ISC BIND、Apache httpd、Solaris telnetd）、版本号、主机名、设备类型（例如打印机、路由器）、操作系统系列（例如 Windows、Linux）。如果可能，Nmap 还会获取通用平台枚举 (CPE) 该信息的表示。有时，可以使用其他详细信息，例如 X 服务器是否对连接开放、SSH 协议版本或 KaZaA 用户名。当然，大多数服务并不提供所有这些信息。</p>
<p><strong>如果 Nmap 是使用 OpenSSL 支持编译的，它将连接到 SSL 服务器以推断该加密层后面的服务侦听。</strong></p>
<p><code>open|filtered</code>某些 UDP 端口在 UDP 端口扫描无法确定端口是开放还是已过滤后仍处于该状态。版本检测将尝试从这些端口引发响应（就像对开放端口所做的那样），如果成功，则将状态更改为开放。<code>open|filtered</code>TCP 端口的处理方式相同。请注意，Nmap<code>-A</code>选项可启用版本检测等功能。</p>
<p><strong>使用以下选项启用和控制版本检测：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-sV（版本检测）</span><br></pre></td></tr></table></figure>

<p>启用版本检测，或者使用<code>-A</code>，它可以启用版本检测等功能。<code>-sR</code> 是 的别名<code>-sV</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--allports（不要从版本检测中排除任何端口）</span><br></pre></td></tr></table></figure>

<p>默认情况下，Nmap 版本检测会跳过 TCP 端口 9100，因为某些打印机只是打印发送到该端口的任何内容，从而导致数十页 HTTP GET 请求、二进制 SSL 会话请求等。可以通过修改或删除中的指令来更改此<code>Exclude</code> 行为<code>nmap-service-probes</code>，或者您可以指定<code>--allports</code>扫描所有端口，而不考虑任何<code>Exclude</code> 指令。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--version-intensity *&lt;intensity&gt;*（设置版本扫描强度）</span><br></pre></td></tr></table></figure>

<p>当执行版本扫描 ( <code>-sV</code>) 时，Nmap 发送一系列探测，每个探测都分配有一个 1 到 9 之间的稀有值。编号较低的探测器对多种常见服务有效，而编号较高的探测器则很少有用。强度级别指定应应用哪些探针。数字越高，服务被正确识别的可能性就越大。然而，高强度扫描需要更长的时间。强度必须介于 0 和 9 之间。 默认值为 7。 当探头通过 <code>nmap-service-probes</code> <code>ports</code>指令，无论强度水平如何，都会尝试该探针。这可确保始终针对任何开放端口 53 尝试 DNS 探测，针对 443 等进行 SSL 探测。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--version-light（启用灯光模式）</span><br></pre></td></tr></table></figure>

<p>这是 的方便别名 <code>--version-intensity 2</code>。这种轻型模式使版本扫描速度更快，但识别服务的可能性稍低。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--version-all（尝试每个探针）</span><br></pre></td></tr></table></figure>

<p>确保针对每个端口尝试每个探测。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--version-trace（跟踪版本扫描活动）</span><br></pre></td></tr></table></figure>

<p>这会导致 Nmap 打印出有关版本扫描正在执行的操作的大量调试信息。它是您所获得的内容的子集<code>--packet-trace</code>。</p>
<h3 id="操作系统检测"><a href="#操作系统检测" class="headerlink" title="操作系统检测"></a>操作系统检测</h3><p><strong>Nmap 最著名的功能之一是使用 TCP&#x2F;IP 堆栈指纹进行远程操作系统检测。</strong></p>
<p>Nmap 向远程主机发送一系列 TCP 和 UDP 数据包，并检查响应中的几乎每一位。在执行了数十项测试（例如 TCP ISN 采样、TCP 选项支持和排序、IP ID 采样以及初始窗口大小检查）后，Nmap 将结果与它的结果进行比较 <code>nmap-os-db</code> 数据库包含 2,600 多个已知操作系统指纹，如果匹配则打印出操作系统详细信息。每个指纹包括操作系统的自由形式文本描述，以及提供供应商名称（例如 Sun）、底层操作系统（例如 Solaris）、操作系统代（例如 10）和设备类型（通用、路由器、交换机、游戏）的分类。控制台等）。大多数指纹还具有通用平台枚举 (CPE) 表示，如 <code>cpe:/o:linux:linux_kernel:2.6</code>.</p>
<p>如果Nmap无法猜测一台机器的操作系统，并且条件良好（例如至少找到一个开放端口和一个关闭端口），Nmap将提供一个URL，您可以使用该URL来提交指纹机器上运行的操作系统。</p>
<p>操作系统检测启用了一些其他测试，这些测试无论如何都会利用在该过程中收集的信息。其中之一是 TCP 序列可预测性分类。该值大致衡量针对远程主机建立伪造 TCP 连接的难度。它对于利用基于源 IP 的信任关系（rlogin、防火墙过滤器等）或隐藏攻击源非常有用。</p>
<p>操作系统检测提供的另一点额外信息是对目标正常运行时间的猜测。这使用 TCP 时间戳选项来猜测计算机上次重新启动的时间。由于时间戳计数器未初始化为零或计数器溢出并回绕，猜测可能不准确，因此仅以详细模式打印。</p>
<p><strong>操作系统检测通过以下选项启用和控制：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-O（启用操作系统检测）</span><br></pre></td></tr></table></figure>

<p>启用操作系统检测。或者，您可以用来<code>-A</code>启用操作系统检测以及其他功能。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--osscan-limit（将操作系统检测限制在有希望的目标）</span><br></pre></td></tr></table></figure>

<p>如果至少找到一个打开和一个关闭的 TCP 端口，操作系统检测会更加有效。设置此选项，Nmap 甚至不会尝试对不满足此条件的主机进行操作系统检测。这可以节省大量时间，特别是在<code>-Pn</code>扫描许多主机时。<code>-O</code>仅当使用或请求操作系统检测时才重要<code>-A</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--osscan-guess; --fuzzy（猜测操作系统检测结果）</span><br></pre></td></tr></table></figure>

<p>当 Nmap 无法检测到完美的操作系统匹配时，它有时会提供近似匹配的可能性。而且必须非常接近，Nmap 才能默认执行此操作。这些（等效）选项中的任何一个都会使 Nmap 猜测更积极。Nmap 仍然会在打印不完美匹配时告诉您，并显示每个猜测的置信度（百分比）。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--max-os-tries（设置针对目标的操作系统检测尝试的最大次数）</span><br></pre></td></tr></table></figure>

<p>当 Nmap 对目标执行操作系统检测但未能找到完美匹配时，它通常会重复尝试。默认情况下，如果条件有利于操作系统指纹提交，Nmap 会尝试五次，如果条件不太好，Nmap 会尝试两次。指定较低的 <code>--max-os-tries</code>值（例如 1）会加快 Nmap 的速度，但您会错过可能识别操作系统的重试。或者，可以设置较高的值，以便在条件有利时允许更多的重试。除了生成更好的指纹以提交并集成到 Nmap OS 数据库中之外，很少这样做。</p>
<h3 id="防火墙-IDS绕过"><a href="#防火墙-IDS绕过" class="headerlink" title="防火墙&#x2F;IDS绕过"></a>防火墙&#x2F;IDS绕过</h3><p>20 世纪 90 年代初，防火墙开始被部署，其明确目的是减少网络连接。其应用代理、网络地址转换和数据包过滤器将庞大的网络与未经过滤的互联网隔离开来。</p>
<p>除了限制网络活动之外，很多公司或组织还使用入侵检测系统 (IDS) 来监控流量。所有主要 IDS 都附带了旨在检测 Nmap 扫描的规则。但是，对于网络管理员和 IDS 供应商来说，通过分析数据包数据有效地检测恶意意图是一个难题。这时，有些 Nmap 选项可以帮助攻击者绕过 IDS。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-f（分片数据包）； --mtu（使用指定的MTU）</span><br></pre></td></tr></table></figure>

<p>这<code>-f</code>选项导致请求的扫描（包括主机发现扫描）使用微小的碎片 IP 数据包。这个想法是将 TCP 标头拆分为多个数据包，以使数据包过滤器、入侵检测系统和其他干扰更难检测到您正在做的事情。</p>
<p>指定此选项一次，Nmap 将在 IP 标头之后将数据包分割成 8 个或更少的字节。因此 20 字节的 TCP 标头将被分成三个数据包。两个包含 TCP 标头的八个字节，另一个包含最后四个字节。当然每个片段也有一个IP头。指定<code>-f</code>再次使用每个片段 16 字节（减少片段数量）。 或者您可以使用该<code>--mtu</code>选项指定您自己的偏移大小。也不要指定<code>-f</code>是否使用<code>--mtu</code>. 偏移量必须是八的倍数。虽然分段数据包不会通过对所有 IP 分段进行排队的数据包过滤器和防火墙（例如<code>CONFIG_IP_ALWAYS_DEFRAG</code>Linux 内核中的选项），但某些网络无法承受由此造成的性能损失，因此将其禁用。其他人无法启用此功能，因为片段可能采用不同的路由进入其网络。</p>
<p>一些源系统在内核中对传出数据包进行碎片整理。Linux 与 iptables 连接跟踪模块就是这样的一个例子。在Wireshark等嗅探器运行时进行扫描 ，以确保发送的数据包是分段的。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-D *&lt;decoy1&gt;*[,*&lt;decoy2&gt;*][,ME][,...] （用诱饵掩盖扫描）</span><br></pre></td></tr></table></figure>

<p>执行诱饵扫描使得远程主机看起来您指定为诱饵的主机也在扫描目标网络。因此，他们的 IDS 可能会报告来自唯一 IP 地址的 5-10 个端口扫描，但他们不知道哪个 IP 正在扫描它们以及哪些是无辜的诱饵。</p>
<p>虽然可以通过路由器路径跟踪、响应丢弃和其他主动机制来克服这种情况，但它通常是隐藏 IP 地址的有效技术。</p>
<p>用逗号分隔每个诱饵主机，您可以选择用作 <code>ME</code> 诱饵之一来表示您的真实 IP 地址的位置。如果你放在 <code>ME</code>第六个或更高的位置，一些常见的端口扫描检测器（例如 Solar Designer 优秀的 Scanlogd） 根本不可能显示你的 IP 地址。如果你不使用<code>ME</code>，Nmap 会将你置于随机位置。您还可以使用它 <code>RND</code> 来生成随机的、非保留的 IP 地址，或者生成地址。<code>RND:*</code><number><code>*</code>*<code>&lt;number&gt;</code>*请注意，用作诱饵的主机应该处于启动状态，否则您可能会意外地对目标进行 SYN 淹没。此外，如果网络上实际上只有一台主机，则可以很容易地确定哪台主机正在扫描。您可能希望使用 IP 地址而不是名称（这样诱饵网络就不会在其名称服务器日志中看到您）。目前仅 IPv4 支持随机 IP 地址生成诱饵在初始主机发现扫描（使用 ICMP、SYN、ACK 或其他）和实际端口扫描阶段都使用。在远程操作系统检测期间也会使用诱饵 ( <code>-O</code>)。诱饵不能与版本检测或 TCP 连接扫描一起使用。当扫描延迟生效时，延迟会在每批欺骗探针之间强制执行，而不是在每个单独的探针之间强制执行。由于诱饵是一次性批量发送的，因此它们可能会暂时违反拥塞控制限制。</p>
<p>值得注意的是，使用太多诱饵可能会减慢扫描速度，甚至可能降低扫描的准确性。此外，一些 ISP 会过滤掉您的欺骗性数据包，但许多 ISP 根本不限制欺骗性 IP 数据包。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-S *&lt;IP_Address&gt;*（欺骗源地址）</span><br></pre></td></tr></table></figure>

<p>在某些情况下，Nmap 可能无法确定您的源地址。在这种情况下，请使用<code>-S</code>您希望通过其发送数据包的接口的 IP 地址。该标志的另一种可能用途是欺骗扫描，使目标认为<em>其他人</em>正在扫描它们。此类用途通常需要选项 <code>-e</code>和。<code>-Pn</code>请注意，您通常不会收到回复数据包（它们将被发送到您正在欺骗的 IP），因此 Nmap 不会生成有用的报告。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-e *&lt;interface&gt;*（使用指定接口）</span><br></pre></td></tr></table></figure>

<p>告诉 Nmap 在哪个接口上发送和接收数据包。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--source-port *&lt;portnumber&gt;*; -g *&lt;portnumber&gt;*（欺骗源端口号）</span><br></pre></td></tr></table></figure>

<p>一种常见错误配置是仅根据源端口号来信任流量。这种情况下DNS 可能会被破坏，因为来自外部服务器的 UDP DNS 回复无法再进入网络。</p>
<p>FTP 是另一个常见的例子。在主动 FTP 传输中，远程服务器尝试建立回客户端的连接以传输请求的文件。这些问题的安全解决方案通常以应用程序级代理或协议解析防火墙模块的形式存在。</p>
<p>注意到 DNS 回复来自端口 53，活动 FTP 来自端口 20，许多管理员陷入了简单地允许来自这些端口的传入流量的陷阱。他们通常假设没有攻击者会注意到并利用此类防火墙漏洞。在其他情况下，管理员认为这是一个短期的权宜之计，直到他们可以实施更安全的解决方案。然后他们忘记了安全升级。过度劳累的网络管理员并不是唯一陷入这个陷阱的人。</p>
<p>许多产品都附带了这些不安全的规则。Windows 2000 和 Windows XP 附带的 IPsec 筛选器包含一条隐式规则，允许来自端口 88 (Kerberos) 的所有 TCP 或 UDP 流量。</p>
<p>在另一个众所周知的案例中，Zone Alarm 个人防火墙版本高达 2.1.25 允许任何源端口为 53 (DNS) 或 67 (DHCP) 的传入 UDP 数据包。</p>
<p>Nmap 提供了<code>-g</code>和 <code>--source-port</code>选项（它们是等效的）来利用这些弱点。只需提供一个端口号，Nmap 就会在可能的情况下从该端口发送数据包。大多数使用原始套接字的扫描操作（包括 SYN 和 UDP 扫描）完全支持该选项。值得注意的是，该选项对于使用正常操作系统套接字的任何操作都没有影响，包括 DNS 请求、TCP<code>connect</code> 扫描、版本检测和脚本扫描。设置源端口对于操作系统检测也不起作用，因为 Nmap 必须使用不同的端口号才能使某些操作系统检测测试正常工作。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--data *&lt;hex string&gt;*（将自定义二进制数据附加到发送的数据包）</span><br></pre></td></tr></table></figure>

<p>此选项允许您将二进制数据作为有效负载包含在发送的数据包中。 *<code>&lt;hex string&gt;</code>*可以用以下任意格式指定：、 或 . 使用示例是和 。请注意，如果您指定一个数字，则 不会执行字节顺序转换。确保按照接收者期望的字节顺序指定信息。 <code>0xAABBCCDDEEFF*</code>&lt;…&gt;<code>*``AABBCCDDEEFF*</code>&lt;…&gt;<code>*``\xAA\xBB\xCC\xDD\xEE\xFF*</code>&lt;…&gt;<code>*``--data 0xdeadbeef``--data \xCA\xFE\x09``0x00ff</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--data-string *&lt;string&gt;*（将自定义字符串附加到发送的数据包）</span><br></pre></td></tr></table></figure>

<p>此选项允许您在发送的数据包中包含常规字符串作为有效负载。*<code>&lt;string&gt;</code>*可以包含任何字符串。但是，请注意，某些字符可能取决于系统的区域设置，并且接收者可能看不到相同的信息。另外，请确保将字符串括在双引号中，并从 shell 中转义任何特殊字符。示例：<code>--data-string &quot;Scan conducted by Security Ops, extension 7192&quot;</code> 或<code>--data-string &quot;Ph34r my l33t skills&quot;</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--data-length *&lt;number&gt;*（将随机数据附加到发送的数据包中）</span><br></pre></td></tr></table></figure>

<p>通常，Nmap 发送仅包含标头的极简数据包。因此它的 TCP 数据包通常为 40 个字节，而 ICMP 回显请求仅为 28 个字节。某些 UDP 端口 和 IP 协议 默认情况下会获取自定义负载。此选项告诉 Nmap 将给定数量的随机字节附加到其发送的大多数数据包中，并且不使用任何特定于协议的有效负载。（<code>--data-length 0</code> 不用于随机或特定于协议的有效负载。 操作系统检测 ( <code>-O</code>) 数据包不受影响，因为那里的准确性需要探测一致性，但大多数 ping 和 portscan 数据包都支持这一点。它会稍微减慢速度，但可以使扫描稍微不那么明显。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--ip-options *&lt;R|S [route]|L [route]|T|U ... &gt;*; --ip-options *&lt;hex string&gt;* （发送带有指定ip选项的数据包）</span><br></pre></td></tr></table></figure>

<p>IP协议提供了多个可以放置在数据包标头中的选项。与无处不在的 TCP 选项不同，出于实用性和安全性考虑，IP 选项很少见。事实上，许多互联网路由器会阻止最危险的选项，例如源路由。然而，在某些情况下，选项对于确定和操作到目标计算机的网络路由仍然有用。例如，即使更传统的跟踪路由式方法失败，您也可以使用记录路由选项来确定到目标的路径。或者，如果您的数据包被某个防火墙丢弃，您可以使用严格或松散源路由选项指定不同的路由。指定 IP 选项的最强大方法是简单地将值作为参数传递给 <code>--ip-options</code>. 在每个十六进制数字 <code>\x</code>前面加上两位数字。您可以重复某些字符，方法是在它们后面加上星号，然后输入您希望它们重复的次数。例如， <code>\x01\x07\x04\x00*36\x01</code>是包含 36 NUL 字节的十六进制字符串。Nmap 还提供了指定选项的快捷方式机制。只需传递字母<code>R</code>、 <code>T</code>、 或即可<code>U</code>分别请求记录路由、 记录时间戳 或同时请求这两个选项。松散或严格的源路由可以用或后跟一个空格，然后是空格分隔的 IP 地址列表来 指定。<code>L``S</code>如果您希望查看发送和接收的数据包中的选项，请指定<code>--packet-trace</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--ttl *&lt;value&gt;*（设置IP生存时间字段）</span><br></pre></td></tr></table></figure>

<p>将发送数据包中的 IPv4 生存时间字段设置为给定值。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--randomize-hosts（随机化目标主机顺序）</span><br></pre></td></tr></table></figure>

<p>告诉 Nmap 在扫描每组最多 16384 个主机之前对它们进行打乱。这可以使扫描对于各种网络监控系统来说不太明显，特别是当您将其与慢速计时选项结合使用时。如果您想随机分配更大的组大小，请增加 <code>PING_GROUP_SZ</code> 并<code>nmap.h</code> 重新编译。另一种解决方案是使用列表扫描 ( ) 生成目标 IP 列表，使用 Perl 脚本对其进行随机化，然后使用 向 Nmap 提供整个列表 。<code>-sL -n -oN *</code><filename><code>*``-iL</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--spoof-mac *&lt;MAC address, prefix, or vendor name&gt;*（欺骗MAC地址）</span><br></pre></td></tr></table></figure>

<p>要求 Nmap对它发送的所有原始以太网帧<code>--send-eth</code>使用给定的 MAC 地址 。此选项意味着 确保 Nmap 实际发送以太网级数据包。给出的 MAC 可以采用多种格式。如果只是数字<code>0</code>，Nmap 会为会话选择一个完全随机的 MAC 地址。如果给定的字符串是偶数个十六进制数字（各对可选地用冒号分隔），Nmap 将使用它们作为 MAC。如果提供的十六进制数字少于 12 个，Nmap 将使用随机值填充剩余的 6 个字节。如果参数不是零或十六进制字符串，Nmap 会查找 <code>nmap-mac-prefixes</code>包含给定字符串的供应商名称（不区分大小写）。如果找到匹配项，Nmap 将使用供应商的 OUI（三字节前缀） 并随机填充剩余的三个字节。有效<code>--spoof-mac</code>参数示例为<code>Apple</code>、<code>0</code>、 <code>01:02:03:04:05:06</code>、<code>deadbeefcafe</code>、<code>0020F2</code>和<code>Cisco</code>。此选项仅影响原始数据包扫描，例如 SYN 扫描或操作系统检测，而不影响面向连接的功能，例如版本检测或 Nmap 脚本引擎。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--proxies *&lt;Comma-separated list of proxy URLs&gt;*（通过代理链中继 TCP 连接）</span><br></pre></td></tr></table></figure>

<p>要求 Nmap 通过提供的一个或多个 HTTP 或 SOCKS4 代理链与最终目标建立 TCP 连接。代理可以帮助隐藏扫描的真实来源或规避某些防火墙限制，但它们可能会增加延迟，从而影响扫描性能。用户可能需要相应地调整 Nmap 超时和其他扫描参数。特别是，较低的值<code>--max-parallelism</code>可能会有所帮助，因为某些代理拒绝处理 Nmap 默认打开的并发连接数。此选项采用代理列表作为参数，以 URL 格式表示<code>proto://host:port</code>。使用逗号分隔链中的节点 URL。尚不支持身份验证。有效协议是<code>HTTP</code>和<code>SOCKS4</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--badsum（发送带有伪造 TCP/UDP 校验和的数据包）</span><br></pre></td></tr></table></figure>

<p>要求 Nmap 对发送到目标主机的数据包使用无效的 TCP、UDP 或 SCTP 校验和。由于几乎所有主机 IP 堆栈都会正确丢弃这些数据包，因此收到的任何响应都可能来自防火墙或 IDS，它们不会验证校验和。</p>
<h3 id="一些例子"><a href="#一些例子" class="headerlink" title="一些例子"></a>一些例子</h3><p><strong>nmap -v scanme.nmap.org</strong></p>
<p>该选项扫描机器上所有保留的 TCP 端口 <code>scanme.nmap.org</code>。该<code>-v</code> 选项启用详细模式。</p>
<p><strong>nmap -sS -O scanme.nmap.org&#x2F;24</strong></p>
<p>对 Scanme 所在的 &#x2F;24 大小的网络上 256 个 IP 范围内的每台计算机启动秘密 SYN 扫描。它还尝试确定每台已启动并正在运行的主机上正在运行什么操作系统。由于 SYN 扫描和操作系统检测，这需要 root 权限。</p>
<p><strong>nmap -sV -p 22,53,110,143,4564 198.116.0-255.1-127</strong></p>
<p>在 198.116.0.0&#x2F;16 地址空间中 255 个可能的 8 位子网中每个子网的前半部分启动主机枚举和 TCP 扫描。这会测试系统是否在其标准端口或端口 4564 上运行 SSH、DNS、POP3 或 IMAP。对于发现打开的任何这些端口，版本检测用于确定正在运行的应用程序。</p>
<p><strong>nmap -v -iR 100000 -Pn -p 80</strong></p>
<p>要求 Nmap 随机选择 100,000 个主机并扫描它们的 Web 服务器（端口 80）。主机枚举被禁用， <code>-Pn</code>因为当您只探测每个目标主机上的一个端口时，首先发送几个探测来确定主机是否已启动是浪费。</p>
<p><strong>nmap -Pn -p80 -oX 日志&#x2F;pb-port80scan.xml -oG 日志&#x2F;pb-port80scan.gnmap 216.163.128.20&#x2F;20</strong></p>
<p>这会扫描 4096 个 IP 中的任何 Web 服务器（无需对它们执行 ping 操作），并将输出保存为 grepable 和 XML 格式。</p>
<h2 id="nmap的原理"><a href="#nmap的原理" class="headerlink" title="nmap的原理"></a>nmap的原理</h2><p>通过上述对nmap强大功能的学习，可以总结出nmap的运行原理即是基于不同的目的，选取不同的选项，发送不同的数据包，返回不同的结果。</p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>这篇博客主要是列举nmap的常用功能和这些选项的细节，都是参考的nmap官方文档。有些地方直译过来可能不太准确，之后会根据实际使用情况修改相关说明。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="M4c0ndo">M4c0ndo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://m4c0ndo.github.io/2023/10/04/nmap%E6%8E%A2%E6%B5%8B%E7%AB%AF%E5%8F%A3%E5%BC%80%E6%94%BE%E7%9A%84%E5%8E%9F%E7%90%86/">https://m4c0ndo.github.io/2023/10/04/nmap探测端口开放的原理/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://M4c0ndo.github.io" target="_blank">M4c0ndo's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/nmap/">nmap</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/09/28/%E7%BC%96%E5%86%99%E7%AC%AC%E4%B8%80%E4%B8%AAPOC/" title="编写第一个POC"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">编写第一个POC</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">M4c0ndo</div><div class="author-info__description">纸上得来终觉浅，绝知此事要躬行。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/M4c0ndo"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/M4c0ndo" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Welcome to my Blog^^.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#nmap"><span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nmap%E7%9A%84%E9%80%89%E9%A1%B9%E6%91%98%E8%A6%81"><span class="toc-text">nmap的选项摘要</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0"><span class="toc-text">主机发现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">端口扫描基础知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E6%8A%80%E6%9C%AF"><span class="toc-text">端口扫描技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E8%A7%84%E6%A0%BC%E5%92%8C%E6%89%AB%E6%8F%8F%E9%A1%BA%E5%BA%8F"><span class="toc-text">端口规格和扫描顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%92%8C%E7%89%88%E6%9C%AC%E6%8E%A2%E6%B5%8B"><span class="toc-text">服务和版本探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A3%80%E6%B5%8B"><span class="toc-text">操作系统检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99-IDS%E7%BB%95%E8%BF%87"><span class="toc-text">防火墙&#x2F;IDS绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E4%BE%8B%E5%AD%90"><span class="toc-text">一些例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nmap%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-text">nmap的原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E"><span class="toc-text">写在最后</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/04/nmap%E6%8E%A2%E6%B5%8B%E7%AB%AF%E5%8F%A3%E5%BC%80%E6%94%BE%E7%9A%84%E5%8E%9F%E7%90%86/" title="nmap探测端口开放的原理">nmap探测端口开放的原理</a><time datetime="2023-10-04T02:49:28.000Z" title="发表于 2023-10-04 10:49:28">2023-10-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/09/28/%E7%BC%96%E5%86%99%E7%AC%AC%E4%B8%80%E4%B8%AAPOC/" title="编写第一个POC">编写第一个POC</a><time datetime="2023-09-28T15:18:58.000Z" title="发表于 2023-09-28 23:18:58">2023-09-28</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/default_top_img.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By M4c0ndo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
    	el: '#vcomment',
      appId: '1Ez1NgYZiGv6n04mC3ywLZ3m-gzGzoHsz',
      appKey: 'J4hFgWAV1PUj5qNu9Mf1O3Cs',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '//i0.hdslb.com/bfs/emote/',
      emojiMaps: {"2020":"dc709fac0d361370bcf0d36d32adb97df7c95824.png","tv_白眼":"c1d59f439e379ee50eef488bcb5e5378e5044ea4.png","tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_坏笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_难过":"87f46748d3f142ebc6586ff58860d0e2fc8263ba.png","tv_生气":"26702dcafdab5e8225b43ffd23c94ac1ff932654.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_斜眼笑":"911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_发怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_惊吓":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png","tv_呕吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_疑问":"0793d949b18d7be716078349c202c15ff166f314.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_鼓掌":"1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png","tv_抠鼻":"c666f55e88d471e51bbd9fab9bb308110824a6eb.png","tv_亲亲":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_调皮":"b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png","tv_笑哭":"1abc628f6d4f4caf9d0e7800878f4697abbc8273.png","tv_晕":"5443c22b4d07fb1907ccc610c8e6db254f2461b7.png","tv_点赞":"f85c354995bd99e28fc76c869bfe42ba6438eff4.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_睡着":"8b196675b53af58264f383c50ad0945048290b33.png","tv_色":"61822c7e9aae5da76475e7892534545336b23a6f.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_无奈":"ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png","tv_再见":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_流汗":"cead1c351ab8d79e9f369605beb90148db0fbed3.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_抓狂":"fe31c08edad661d63762b04e17b8d5ae3c71a757.png","tv_黑人问号":"45821a01f51bc867da9edbaa2e070410819a95b2.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_打脸":"56ab10b624063e966bfcb76ea5dc4794d87dfd47.png","tv_闭嘴":"c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png","tv_鄙视":"6e72339f346a692a495b123174b49e4e8e781303.png","tv_腼腆":"89712c0d4af73e67f89e35cbc518420380a7f6f4.png","tv_馋":"fc7e829b845c43c623c8b490ee3602b7f0e76a31.png","tv_可爱":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_发财":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_生病":"8b0ec90e6b86771092a498c54f09fc94621c1900.png","tv_流鼻血":"c32d39db2737f89b904ca32700d140a9241b0767.png","tv_尴尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_流泪":"7e71cde7858f0cd50d74b0264aa26db612a8a167.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_皱眉":"72ccad6679fea0d14cce648b4d818e09b8ffea2d.png","tv_鬼脸":"0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png","tv_调侃":"4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png","tv_目瞪口呆":"0b8cb81a68de5d5365212c99375e7ace3e7891b7.png","2233娘_大笑":"16b8794be990cefa6caeba4d901b934a227ee3b8.png","2233娘_疑问":"0b41f509351958dbb63d472fec0132d1bd03bd14.png","2233娘_吃惊":"d1628c43d35b1530c0504a643ff80b6189fa0a43.png","2233娘_汗":"247cd9df8cdf84b18368c21e3b2dd374e84c0927.png","2233娘_大哭":"476a2a60f6e337b8c0697a592e0aa82781f6b33b.png","2233娘_困惑":"714eeb4eae0d0933b4ff08b7df788b1982f6b940.png","2233娘_耶":"d7178e258a0efc969b65ccc2b1322fb235f5dff4.png","2233娘_怒":"f31953119c51b9748016440ac0b632f779929b37.png","2233娘_卖萌":"ea893aa25355de95ab4f03c2dad3f0c58d0c159e.png","2233娘_委屈":"d9d0bf9d358af8d5761093ec66d4e3f60d963a63.png","2233娘_郁闷":"485203fe7100f2c8fc40b2800a18fe20b35f2f1a.png","2233娘_第一":"3754ee6e5985bd0bd7dfb668981f2a8733398ebd.png","2233娘_喝水":"695bf5429472049b52c1e0de586f8a2511195a23.png","2233娘_吐魂":"e999af499edf38a91ca68b1a9d2f97042c1d6734.png","2233娘_无言":"fdb5870f32cfaf7949e0f88a13f6feba4a48b719.png","热词系列_增加":"142409b595982b8210b2958f3d340f3b47942645.png","热词系列_泪目":"bba3703ab90b7d16fe9dbcb85ed949db687f8331.png","热词系列_保护":"55f8f6445ca7c3170cdfc5b16036abf639ce9b57.png","热词系列_害怕":"d77e2de26da143249f0c0ad7a608c27152c985bf.png","热词系列_爱了爱了":"2a165b555ba20391316366c664ed7891883dc5aa.png","热词系列_问号":"c1d1e76c12180adc8558f47006fe0e7ded4154bb.png","热词系列_吹爆":"b528220f9c37256ed6a37f05bf118e44b08b81e5.png","热词系列_三连":"21f15fe11b7a84d2f2121c16dec50a4e4556f865.png","热词系列_可以":"e08543c71202b36c590094417fcfbb80c3506cd8.png","热词系列_打卡":"a9cf77c78e1b9b40aa3ed4862402fba008ee2f51.png","热词系列_妙啊":"0e98299d7decf5eaffad854977946075c3e91cb8.png","热词系列_这次一定":"a01ca28923daa7cc896c42f27deb4914e20dd572.png","热词系列_AWSL":"c37f88cf799f9badf9d84b7671dc3dd98c0fc0c2.png","热词系列_递话筒":"98e6950e39fbb4dd1c576042063ca632074070ba.png","热词系列_你细品":"535e00658e7e47966f154d3a167fa2365ebc4321.png","热词系列_咕咕":"d8065c2e7ce48c929317a94553499a46fecc262a.png","热词系列_标准结局":"3de98174b510cf7dc5fd1bd08c5d881065e79137.png","热词系列_危":"5cc6c3357c4df544dd8de9d5c5c0cec97c7c9a56.png","热词系列_张三":"255a938f39cea625032b6650036b31aa26c50a3c.png","热词系列_害":"cbe798a194612958537c5282fcca7c3bcd2aa15c.png","热词系列_我裂开了":"29bd57ec4e8952880fea6c9e47aee924e91f10c4.png","热词系列_有内味了":"7ca61680a905b5b6e2e335c630e725b648b03b4d.png","热词系列_猛男必看":"c97064450528a0e45c7e7c365a15fbb13fd61d8c.png","热词系列_奥力给":"c9b8683827ec6c00fea5327c9bec14f581cef2aa.png","热词系列_我哭了":"9e0b3877d649aaf6538fbdd3f937e240a9d808e4.png","热词系列_高产":"9db817cba4a7f4a42398f3b2ec7c0a8e0c247c42.png","热词系列_我酸了":"a8cbf3f6b8cd9377eeb15b9172f3cd683b2e4650.png","热词系列_真香":"e68497c775feaac1c3b1a6cd63a50cfb11b767c4.png","热词系列_我全都要":"d424d1ad8d14c1c9b8367842bc68c658b9229bc1.png","热词系列_神仙UP":"a49e0d0db1e7d35a0f7411be13208951ab448f03.png","热词系列_你币有了":"84820c2b147a8ca02f3c4006b63f76c6313cbfa0.png","热词系列_不愧是你":"9ff2e356797c57ee3b1675ade0883d2d2247be9b.png","热词系列_锤":"35668cc12ae25b9545420e4a85bf21a0bfc03e5d.png","热词系列_秀":"50782fbf5d9b7f48f9467b5c53932981e321eedc.png","热词系列_爷关更":"faad40c56447f1f8abcb4045c17ce159d113d1fd.png","热词系列_有生之年":"f41fdafe2d0fbb8e8bc1598d2cf37e355560103a.png","热词系列_镇站之宝":"24e7a6a6e6383c987215fb905e3ee070aca259b5.png","热词系列_我太男了":"a523f3e4c63e4db1232365765d0ec452f83be97e.png","热词系列_完结撒花":"ea9db62ff5bca8e069cd70c4233353a802835422.png","热词系列_大师球":"f30089248dd137c568edabcb07cf67e0f6e98cf3.png","热词系列_知识盲区":"ccc94600b321a28116081e49ecedaa4ee8728312.png","热词系列_“狼火”":"33ccd3617bfa89e9d1498b13b7542b63f163e5de.png","加油武汉":"eb966aaa5b690d3f9308a9f936f5b5a72a7f956b.png","口罩":"3ad2f66b151496d2a5fb0a8ea75f32265d778dd3.png","鸡腿":"c7860392815d345fa69c4f00ef18d67dccfbd574.png","微笑":"685612eadc33f6bc233776c6241813385844f182.png","笑":"81edf17314cea3b48674312b4364df44d5c01f17.png","呲牙":"b5a5898491944a4268360f2e7a84623149672eb6.png","OK":"4683fd9ffc925fa6423110979d7dcac5eda297f4.png","星星眼":"63c9d1a31c0da745b61cdb35e0ecb28635675db2.png","哦呼":"362bded07ea5434886271d23fa25f5d85d8af06c.png","嫌弃":"de4c0783aaa60ec03de0a2b90858927bfad7154b.png","喜欢":"8a10a4d73a89f665feff3d46ca56e83dc68f9eb8.png","酸了":"92b1c8cbceea3ae0e8e32253ea414783e8ba7806.png","大哭":"2caafee2e5db4db72104650d87810cc2c123fc86.png","害羞":"9d2ec4e1fbd6cb1b4d12d2bbbdd124ccb83ddfda.png","无语":"44667b7d9349957e903b1b62cb91fb9b13720f04.png","疑惑":"b7840db4b1f9f4726b7cb23c0972720c1698d661.png","调皮":"8290b7308325e3179d2154327c85640af1528617.png","喜极而泣":"485a7e0c01c2d70707daae53bee4a9e2e31ef1ed.png","奸笑":"bb84906573472f0a84cebad1e9000eb6164a6f5a.png","偷笑":"6c49d226e76c42cd8002abc47b3112bc5a92f66a.png","大笑":"ca94ad1c7e6dac895eb5b33b7836b634c614d1c0.png","阴险":"ba8d5f8e7d136d59aab52c40fd3b8a43419eb03c.png","捂脸":"6921bb43f0c634870b92f4a8ad41dada94a5296d.png","囧":"12e41d357a9807cc80ef1e1ed258127fcc791424.png","呆":"33ad6000d9f9f168a0976bc60937786f239e5d8c.png","抠鼻":"cb89184c97e3f6d50acfd7961c313ce50360d70f.png","惊喜":"0afecaf3a3499479af946f29749e1a6c285b6f65.png","惊讶":"f8e9a59cad52ae1a19622805696a35f0a0d853f3.png","笑哭":"c3043ba94babf824dea03ce500d0e73763bf4f40.png","妙啊":"b4cb77159d58614a9b787b91b1cd22a81f383535.png","doge":"bba7c12aa51fed0199c241465560dfc2714c593e.png","滑稽":"d15121545a99ac46774f1f4465b895fe2d1411c3.png","吃瓜":"4191ce3c44c2b3df8fd97c33f85d3ab15f4f3c84.png","打call":"431432c43da3ee5aab5b0e4f8931953e649e9975.png","点赞":"1a67265993913f4c35d15a6028a30724e83e7d35.png","鼓掌":"895d1fc616b4b6c830cf96012880818c0e1de00d.png","尴尬":"cb321684ed5ce6eacdc2699092ab8fe7679e4fda.png","冷":"cb0ebbd0668640f07ebfc0e03f7a18a8cd00b4ed.png","灵魂出窍":"43d3db7d97343c01b47e22cfabeca84b4251f35a.png","委屈":"d2f26cbdd6c96960320af03f5514c5b524990840.png","傲娇":"010540d0f61220a0db4922e4a679a1d8eca94f4e.png","疼":"905fd9a99ec316e353b9bd4ecd49a5f0a301eabf.png","吓":"9c10c5ebc7bef27ec641b8a1877674e0c65fea5d.png","生病":"0f25ce04ae1d7baf98650986454c634f6612cb76.png","吐":"06946bfe71ac48a6078a0b662181bb5cad09decc.png","嘘声":"e64af664d20716e090f10411496998095f62f844.png","捂眼":"c5c6d6982e1e53e478daae554b239f2b227b172b.png","思考":"cfa9b7e89e4bfe04bbcd34ccb1b0df37f4fa905c.png","再见":"fc510306bae26c9aec7e287cdf201ded27b065b9.png","翻白眼":"eba54707c7168925b18f6f8b1f48d532fe08c2b1.png","哈欠":"888d877729cbec444ddbd1cf4c9af155a7a06086.png","奋斗":"bb2060c15dba7d3fd731c35079d1617f1afe3376.png","墨镜":"3a03aebfc06339d86a68c2d893303b46f4b85771.png","撇嘴":"531863568e5668c5ac181d395508a0eeb1f0cda4.png","难过":"a651db36701610aa70a781fa98c07c9789b11543.png","抓狂":"4c87afff88c22439c45b79e9d2035d21d5622eba.png","生气":"3195714219c4b582a4fb02033dd1519913d0246d.png","干杯":"8da12d5f55a2c7e9778dcc05b40571979fe208e6.png","爱心":"ed04066ea7124106d17ffcaf75600700e5442f5c.png","锦鲤":"643d6c19c8164ffd89e3e9cdf093cf5d773d979c.png","胜利":"b49fa9f4b1e7c3477918153b82c60b114d87347c.png","加油":"c7aaeacb21e107292d3bb053e5abde4a4459ed30.png","保佑":"fafe8d3de0dc139ebe995491d2dac458a865fb30.png","抱拳":"89516218158dbea18ab78e8873060bf95d33bbbe.png","响指":"1b5c53cf14336903e1d2ae3527ca380a1256a077.png","支持":"3c210366a5585706c09d4c686a9d942b39feeb50.png","拥抱":"41780a4254750cdaaccb20735730a36044e98ef3.png","怪我咯":"07cc6077f7f7d75b8d2c722dd9d9828a9fb9e46d.png","跪了":"f2b3aee7e521de7799d4e3aa379b01be032698ac.png","黑洞":"e90ec4c799010f25391179118ccd9f66b3b279ba.png","老鼠":"8e6fb491eb1bb0d5862e7ec8ccf9a3da12b6c155.png","福到了":"5de5373d354c373cf1617b6b836f3a8d53c5a655.png"},
      enableQQ: false,
      path: window.location.pathname,
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>